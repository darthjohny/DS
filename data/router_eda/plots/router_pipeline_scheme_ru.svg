<svg width="1600" height="980" viewBox="0 0 1600 980" fill="none" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1600" y2="980" gradientUnits="userSpaceOnUse">
      <stop offset="0" stop-color="#F7F3EA"/>
      <stop offset="1" stop-color="#EEF5F1"/>
    </linearGradient>
    <linearGradient id="dbBox" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="#FFF7D6"/>
      <stop offset="1" stop-color="#FDE7A7"/>
    </linearGradient>
    <linearGradient id="coreBox" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="#DDEFFF"/>
      <stop offset="1" stop-color="#BDD8F7"/>
    </linearGradient>
    <linearGradient id="edaBox" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="#F6EFE6"/>
      <stop offset="1" stop-color="#E7D6BE"/>
    </linearGradient>
    <linearGradient id="pipeBox" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="#E9F8EA"/>
      <stop offset="1" stop-color="#CFE9D2"/>
    </linearGradient>
    <linearGradient id="warnBox" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="#FAE0E2"/>
      <stop offset="1" stop-color="#F2BFC5"/>
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="160%">
      <feDropShadow dx="0" dy="10" stdDeviation="12" flood-color="#5A5A5A" flood-opacity="0.14"/>
    </filter>
    <marker id="arrow" markerWidth="14" markerHeight="14" refX="10" refY="7" orient="auto">
      <path d="M1 1L11 7L1 13" stroke="#2F3C3A" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
    </marker>
    <style>
      .title { font: 700 38px 'Trebuchet MS', 'Segoe UI', sans-serif; fill: #1E2B2A; }
      .subtitle { font: 500 18px 'Trebuchet MS', 'Segoe UI', sans-serif; fill: #455553; }
      .section { font: 700 19px 'Trebuchet MS', 'Segoe UI', sans-serif; fill: #22302F; }
      .body { font: 500 16px 'Trebuchet MS', 'Segoe UI', sans-serif; fill: #243331; }
      .small { font: 500 14px 'Trebuchet MS', 'Segoe UI', sans-serif; fill: #44514F; }
      .path { stroke: #2F3C3A; stroke-width: 3; fill: none; marker-end: url(#arrow); }
    </style>
  </defs>

  <rect width="1600" height="980" fill="url(#bg)"/>

  <text x="70" y="72" class="title">Схема Пайплайна: Router + Host Similarity</text>
  <text x="70" y="108" class="subtitle">Разделение физического распознавания звезды и оценки похожести на экзопланетные host-stars</text>

  <rect x="70" y="170" width="310" height="118" rx="24" fill="url(#dbBox)" stroke="#B69237" stroke-width="2" filter="url(#shadow)"/>
  <text x="100" y="208" class="section">Референс-слой Gaia</text>
  <text x="100" y="238" class="body">A/B/O/F/G/K/M + dwarf/evolved</text>
  <text x="100" y="265" class="small">Источник: lab.v_gaia_router_training</text>

  <rect x="70" y="340" width="310" height="118" rx="24" fill="url(#edaBox)" stroke="#9B7B4A" stroke-width="2" filter="url(#shadow)"/>
  <text x="100" y="378" class="section">Router EDA</text>
  <text x="100" y="408" class="body">Проверка структуры и физики</text>
  <text x="100" y="435" class="small">/src/router_eda.py</text>

  <rect x="70" y="510" width="310" height="130" rx="24" fill="url(#coreBox)" stroke="#5780A8" stroke-width="2" filter="url(#shadow)"/>
  <text x="100" y="548" class="section">Gaussian Router</text>
  <text x="100" y="578" class="body">Распознаёт spec_class</text>
  <text x="100" y="605" class="body">и evolution_stage</text>
  <text x="100" y="632" class="small">/src/gaussian_router.py</text>

  <rect x="70" y="730" width="310" height="118" rx="24" fill="url(#dbBox)" stroke="#B69237" stroke-width="2" filter="url(#shadow)"/>
  <text x="100" y="768" class="section">NASA hosts + Gaia physics</text>
  <text x="100" y="798" class="body">Обучающий слой для host-model</text>
  <text x="100" y="825" class="small">Источник: lab.v_nasa_gaia_train_dwarfs</text>

  <rect x="470" y="730" width="310" height="118" rx="24" fill="url(#edaBox)" stroke="#9B7B4A" stroke-width="2" filter="url(#shadow)"/>
  <text x="500" y="768" class="section">Host EDA</text>
  <text x="500" y="798" class="body">EDA для NASA host-stars</text>
  <text x="500" y="825" class="small">/src/eda.py</text>

  <rect x="470" y="170" width="320" height="130" rx="24" fill="url(#dbBox)" stroke="#B69237" stroke-width="2" filter="url(#shadow)"/>
  <text x="500" y="208" class="section">Входные кандидаты Gaia</text>
  <text x="500" y="238" class="body">source_id, ra, dec,</text>
  <text x="500" y="265" class="body">teff, logg, radius, quality-поля</text>

  <rect x="470" y="380" width="320" height="140" rx="24" fill="url(#pipeBox)" stroke="#6B9B74" stroke-width="2" filter="url(#shadow)"/>
  <text x="500" y="418" class="section">Оркестратор пайплайна</text>
  <text x="500" y="448" class="body">Вызывает router и host-model,</text>
  <text x="500" y="475" class="body">делит объекты по веткам</text>
  <text x="500" y="505" class="small">/src/star_orchestrator.py</text>

  <rect x="900" y="210" width="300" height="118" rx="24" fill="url(#dbBox)" stroke="#B69237" stroke-width="2" filter="url(#shadow)"/>
  <text x="930" y="248" class="section">Таблица распознавания</text>
  <text x="930" y="278" class="body">Сохраняет результат router</text>
  <text x="930" y="305" class="small">lab.gaia_router_results</text>

  <rect x="900" y="410" width="300" height="118" rx="24" fill="url(#warnBox)" stroke="#B56C78" stroke-width="2" filter="url(#shadow)"/>
  <text x="930" y="448" class="section">Низкий приоритет</text>
  <text x="930" y="478" class="body">A/B/O или evolved</text>
  <text x="930" y="505" class="small">stub + reason_code</text>

  <rect x="900" y="660" width="300" height="130" rx="24" fill="url(#coreBox)" stroke="#5780A8" stroke-width="2" filter="url(#shadow)"/>
  <text x="930" y="698" class="section">Gaussian Similarity</text>
  <text x="930" y="728" class="body">Работает только для</text>
  <text x="930" y="755" class="body">M/K/G/F dwarf</text>
  <text x="930" y="782" class="small">/src/model_gaussian.py</text>

  <rect x="1280" y="530" width="250" height="118" rx="24" fill="url(#dbBox)" stroke="#B69237" stroke-width="2" filter="url(#shadow)"/>
  <text x="1310" y="568" class="section">Таблица приоритизации</text>
  <text x="1310" y="598" class="body">Итоговый ranking</text>
  <text x="1310" y="625" class="small">lab.gaia_priority_results</text>

  <path class="path" d="M225 288V330"/>
  <path class="path" d="M225 458V500"/>
  <path class="path" d="M380 574H440C455 574 470 560 470 540V456"/>
  <path class="path" d="M380 789H440"/>
  <path class="path" d="M790 235H870C885 235 900 245 900 269"/>
  <path class="path" d="M790 450H870"/>
  <path class="path" d="M790 450H845C875 450 890 700 900 725"/>
  <path class="path" d="M780 789H900"/>
  <path class="path" d="M1200 469H1250C1265 469 1280 500 1280 530"/>
  <path class="path" d="M1200 725H1250C1265 725 1280 675 1280 635"/>
  <path class="path" d="M1200 270V350C1200 370 1175 410 1200 410"/>

  <text x="836" y="432" class="small">A/B/O, evolved</text>
  <text x="810" y="704" class="small">M/K/G/F dwarf</text>
  <text x="1208" y="682" class="small">host similarity</text>

  <rect x="70" y="892" width="1460" height="52" rx="18" fill="#FFFFFFA8" stroke="#D4D6D2"/>
  <text x="100" y="924" class="small">Логика: сначала физически распознать звезду, затем пропустить в host-model только M/K/G/F dwarf, а A/B/O и evolved отправить в отдельную ветку низкого приоритета.</text>
</svg>
